{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"prefect-email","text":""},{"location":"#welcome","title":"Welcome!","text":"<p><code>prefect-email</code> is a collection of prebuilt Prefect tasks that can be used to quickly construct Prefect flows that interacts with email services.</p>"},{"location":"#getting-started","title":"Getting Started","text":""},{"location":"#python-setup","title":"Python setup","text":"<p>Requires an installation of Python 3.7+.</p> <p>We recommend using a Python virtual environment manager such as pipenv, conda or virtualenv.</p> <p>These tasks are designed to work with Prefect 2.0. For more information about how to use Prefect, please refer to the Prefect documentation.</p>"},{"location":"#installation","title":"Installation","text":"<p>Install <code>prefect-email</code> with <code>pip</code>:</p> <pre><code>pip install prefect-email\n</code></pre> <p>Then, register to view the block on Prefect Cloud:</p> <pre><code>prefect block register -m prefect_email\n</code></pre> <p>Note, to use the <code>load</code> method on Blocks, you must already have a block document saved through code or saved through the UI.</p>"},{"location":"#send-an-email-using-gmail","title":"Send an email using Gmail","text":"<pre><code>from prefect import flow\nfrom prefect_email import EmailServerCredentials, email_send_message\n\n@flow\ndef example_email_send_message_flow():\n    email_server_credentials = EmailServerCredentials(\n        username=\"your_email_address@gmail.com\",\n        password=\"MUST_be_an_app_password_here!\",\n    )\n    subject = email_send_message(\n        email_server_credentials=email_server_credentials,\n        subject=\"Example Flow Notification using Gmail\",\n        msg=\"This proves email_send_message works!\",\n        email_to=\"someone_awesome@gmail.com\",\n    )\n    return subject\n\nexample_email_send_message_flow()\n</code></pre> <p>Please note, many email services, like Gmail, require an App Password to successfully send emails. If you encounter an error similar to <code>smtplib.SMTPAuthenticationError: (535, b'5.7.8 Username and Password not accepted...</code>, it's likely you are not using an App Password.</p>"},{"location":"#resources","title":"Resources","text":"<p>If you encounter any bugs while using <code>prefect-email</code>, feel free to open an issue in the prefect-email repository.</p> <p>If you have any questions or issues while using <code>prefect-email</code>, you can find help in either the Prefect Discourse forum or the Prefect Slack community.</p> <p>Feel free to \u2b50\ufe0f or watch <code>prefect-email</code> for updates too!</p>"},{"location":"#development","title":"Development","text":"<p>If you'd like to install a version of <code>prefect-email</code> for development, clone the repository and perform an editable install with <code>pip</code>:</p> <pre><code>git clone https://github.com/PrefectHQ/prefect-email.git\n\ncd prefect-email/\n\npip install -e \".[dev]\"\n\n# Install linting pre-commit hooks\npre-commit install\n</code></pre>"},{"location":"credentials/","title":"Credentials","text":""},{"location":"credentials/#prefect_email.credentials","title":"<code>prefect_email.credentials</code>","text":"<p>Credential classes used to perform authenticated interactions with email services</p>"},{"location":"credentials/#prefect_email.credentials-classes","title":"Classes","text":""},{"location":"credentials/#prefect_email.credentials.EmailServerCredentials","title":"<code>EmailServerCredentials</code>","text":"<p>         Bases: <code>Block</code></p> <p>Block used to manage generic email server authentication. It is recommended you use a Google App Password if you use Gmail.</p> <p>Attributes:</p> Name Type Description <code>username</code> <code>Optional[str]</code> <p>The username to use for authentication to the server. Unnecessary if SMTP login is not required.</p> <code>password</code> <code>SecretStr</code> <p>The password to use for authentication to the server. Unnecessary if SMTP login is not required.</p> <code>smtp_server</code> <code>Union[SMTPServer, str]</code> <p>Either the hostname of the SMTP server, or one of the keys from the built-in SMTPServer Enum members, like \"gmail\".</p> <code>smtp_type</code> <code>Union[SMTPType, str]</code> <p>Either \"SSL\", \"STARTTLS\", or \"INSECURE\".</p> <code>smtp_port</code> <code>Optional[int]</code> <p>If provided, overrides the smtp_type's default port number.</p> Example <p>Load stored email server credentials: <pre><code>from prefect_email import EmailServerCredentials\nemail_credentials_block = EmailServerCredentials.load(\"BLOCK_NAME\")\n</code></pre></p> Source code in <code>prefect_email/credentials.py</code> <pre><code>class EmailServerCredentials(Block):\n\"\"\"\n    Block used to manage generic email server authentication.\n    It is recommended you use a\n    [Google App Password](https://support.google.com/accounts/answer/185833)\n    if you use Gmail.\n\n    Attributes:\n        username: The username to use for authentication to the server.\n            Unnecessary if SMTP login is not required.\n        password: The password to use for authentication to the server.\n            Unnecessary if SMTP login is not required.\n        smtp_server: Either the hostname of the SMTP server, or one of the\n            keys from the built-in SMTPServer Enum members, like \"gmail\".\n        smtp_type: Either \"SSL\", \"STARTTLS\", or \"INSECURE\".\n        smtp_port: If provided, overrides the smtp_type's default port number.\n\n    Example:\n        Load stored email server credentials:\n        ```python\n        from prefect_email import EmailServerCredentials\n        email_credentials_block = EmailServerCredentials.load(\"BLOCK_NAME\")\n        ```\n    \"\"\"  # noqa E501\n\n    _block_type_name = \"Email Server Credentials\"\n    _logo_url = \"https://images.ctfassets.net/gm98wzqotmnx/3PcxFuO9XUqs7wU9MiUBMg/ca740e27815d15528373aced667f58b9/email__1_.png?h=250\"  # noqa\n\n    username: Optional[str] = None\n    password: SecretStr = SecretStr(\"\")\n    smtp_server: Union[SMTPServer, str] = SMTPServer.GMAIL\n    smtp_type: Union[SMTPType, str] = SMTPType.SSL\n    smtp_port: Optional[int] = None\n\n    @validator(\"smtp_server\", pre=True)\n    def _cast_smtp_server(cls, value):\n\"\"\"\n        Cast the smtp_server to an SMTPServer Enum member, if valid.\n        \"\"\"\n        return _cast_to_enum(value, SMTPServer)\n\n    @validator(\"smtp_type\", pre=True)\n    def _cast_smtp_type(cls, value):\n\"\"\"\n        Cast the smtp_type to an SMTPType Enum member, if valid.\n        \"\"\"\n        if isinstance(value, int):\n            return SMTPType(value)\n        return _cast_to_enum(value, SMTPType, restrict=True)\n\n    def get_server(self) -&gt; SMTP:\n\"\"\"\n        Gets an authenticated SMTP server.\n\n        Returns:\n            SMTP: An authenticated SMTP server.\n\n        Example:\n            Gets a GMail SMTP server through defaults.\n            ```python\n            from prefect import flow\n            from prefect_email import EmailServerCredentials\n\n            @flow\n            def example_get_server_flow():\n                email_server_credentials = EmailServerCredentials(\n                    username=\"username@gmail.com\",\n                    password=\"password\",\n                )\n                server = email_server_credentials.get_server()\n                return server\n\n            example_get_server_flow()\n            ```\n        \"\"\"\n        smtp_server = self.smtp_server\n        if isinstance(smtp_server, SMTPServer):\n            smtp_server = smtp_server.value\n\n        smtp_type = self.smtp_type\n        smtp_port = self.smtp_port\n        if smtp_port is None:\n            smtp_port = smtp_type.value\n\n        if smtp_type == SMTPType.INSECURE:\n            server = SMTP(smtp_server, smtp_port)\n        else:\n            context = ssl.create_default_context()\n            if smtp_type == SMTPType.SSL:\n                server = SMTP_SSL(smtp_server, smtp_port, context=context)\n            elif smtp_type == SMTPType.STARTTLS:\n                server = SMTP(smtp_server, smtp_port)\n                server.starttls(context=context)\n            if self.username is not None:\n                server.login(self.username, self.password.get_secret_value())\n\n        return server\n</code></pre>"},{"location":"credentials/#prefect_email.credentials.EmailServerCredentials-functions","title":"Functions","text":""},{"location":"credentials/#prefect_email.credentials.EmailServerCredentials.get_server","title":"<code>get_server()</code>","text":"<p>Gets an authenticated SMTP server.</p> <p>Returns:</p> Name Type Description <code>SMTP</code> <code>SMTP</code> <p>An authenticated SMTP server.</p> Example <p>Gets a GMail SMTP server through defaults. <pre><code>from prefect import flow\nfrom prefect_email import EmailServerCredentials\n\n@flow\ndef example_get_server_flow():\n    email_server_credentials = EmailServerCredentials(\n        username=\"username@gmail.com\",\n        password=\"password\",\n    )\n    server = email_server_credentials.get_server()\n    return server\n\nexample_get_server_flow()\n</code></pre></p> Source code in <code>prefect_email/credentials.py</code> <pre><code>def get_server(self) -&gt; SMTP:\n\"\"\"\n    Gets an authenticated SMTP server.\n\n    Returns:\n        SMTP: An authenticated SMTP server.\n\n    Example:\n        Gets a GMail SMTP server through defaults.\n        ```python\n        from prefect import flow\n        from prefect_email import EmailServerCredentials\n\n        @flow\n        def example_get_server_flow():\n            email_server_credentials = EmailServerCredentials(\n                username=\"username@gmail.com\",\n                password=\"password\",\n            )\n            server = email_server_credentials.get_server()\n            return server\n\n        example_get_server_flow()\n        ```\n    \"\"\"\n    smtp_server = self.smtp_server\n    if isinstance(smtp_server, SMTPServer):\n        smtp_server = smtp_server.value\n\n    smtp_type = self.smtp_type\n    smtp_port = self.smtp_port\n    if smtp_port is None:\n        smtp_port = smtp_type.value\n\n    if smtp_type == SMTPType.INSECURE:\n        server = SMTP(smtp_server, smtp_port)\n    else:\n        context = ssl.create_default_context()\n        if smtp_type == SMTPType.SSL:\n            server = SMTP_SSL(smtp_server, smtp_port, context=context)\n        elif smtp_type == SMTPType.STARTTLS:\n            server = SMTP(smtp_server, smtp_port)\n            server.starttls(context=context)\n        if self.username is not None:\n            server.login(self.username, self.password.get_secret_value())\n\n    return server\n</code></pre>"},{"location":"credentials/#prefect_email.credentials.SMTPServer","title":"<code>SMTPServer</code>","text":"<p>         Bases: <code>Enum</code></p> <p>Server used to send email.</p> Source code in <code>prefect_email/credentials.py</code> <pre><code>class SMTPServer(Enum):\n\"\"\"\n    Server used to send email.\n    \"\"\"\n\n    AOL = \"smtp.aol.com\"\n    ATT = \"smtp.mail.att.net\"\n    COMCAST = \"smtp.comcast.net\"\n    ICLOUD = \"smtp.mail.me.com\"\n    GMAIL = \"smtp.gmail.com\"\n    OUTLOOK = \"smtp-mail.outlook.com\"\n    YAHOO = \"smtp.mail.yahoo.com\"\n</code></pre>"},{"location":"credentials/#prefect_email.credentials.SMTPType","title":"<code>SMTPType</code>","text":"<p>         Bases: <code>Enum</code></p> <p>Protocols used to secure email transmissions.</p> Source code in <code>prefect_email/credentials.py</code> <pre><code>class SMTPType(Enum):\n\"\"\"\n    Protocols used to secure email transmissions.\n    \"\"\"\n\n    SSL = 465\n    STARTTLS = 587\n    INSECURE = 25\n</code></pre>"},{"location":"message/","title":"Message","text":""},{"location":"message/#prefect_email.message","title":"<code>prefect_email.message</code>","text":"<p>Tasks for interacting with email message services</p>"},{"location":"message/#prefect_email.message-classes","title":"Classes","text":""},{"location":"message/#prefect_email.message-functions","title":"Functions","text":""},{"location":"message/#prefect_email.message.email_send_message","title":"<code>email_send_message(subject, msg, email_server_credentials, msg_plain=None, email_from=None, email_to=None, email_to_cc=None, email_to_bcc=None, attachments=None)</code>  <code>async</code>","text":"<p>Sends an email message from an authenticated email service over SMTP. Sending messages containing HTML code is supported - the default MIME type is set to the text/html.</p> <p>Parameters:</p> Name Type Description Default <code>subject</code> <code>str</code> <p>The subject line of the email.</p> required <code>msg</code> <code>str</code> <p>The contents of the email, added as html; can be used in combination with msg_plain.</p> required <code>msg_plain</code> <code>Optional[str]</code> <p>The contents of the email as plain text, can be used in combination with msg.</p> <code>None</code> <code>email_to</code> <code>Optional[Union[str, List[str]]]</code> <p>The email addresses to send the message to, separated by commas. If a list is provided, will join the items, separated by commas.</p> <code>None</code> <code>email_to_cc</code> <code>Optional[Union[str, List[str]]]</code> <p>Additional email addresses to send the message to as cc, separated by commas. If a list is provided, will join the items, separated by commas.</p> <code>None</code> <code>email_to_bcc</code> <code>Optional[Union[str, List[str]]]</code> <p>Additional email addresses to send the message to as bcc, separated by commas. If a list is provided, will join the items, separated by commas.</p> <code>None</code> <code>attachments</code> <code>Optional[List[str]]</code> <p>Names of files that should be sent as attachment.</p> <code>None</code> <p>Returns:</p> Name Type Description <code>MimeText</code> <p>The MIME Multipart message of the email.</p> Example <p>Sends a notification email to someone@gmail.com. <pre><code>from prefect import flow\nfrom prefect_email import EmailServerCredentials, email_send_message\n\n@flow\ndef example_email_send_message_flow():\n    email_server_credentials = EmailServerCredentials(\n        username=\"username@email.com\",\n        password=\"password\",\n    )\n    subject = email_send_message(\n        email_server_credentials=email_server_credentials,\n        subject=\"Example Flow Notification\",\n        msg=\"This proves email_send_message works!\",\n        email_to=\"someone@email.com\",\n    )\n    return subject\n\nexample_email_send_message_flow()\n</code></pre></p> Source code in <code>prefect_email/message.py</code> <pre><code>@task\nasync def email_send_message(\n    subject: str,\n    msg: str,\n    email_server_credentials: \"EmailServerCredentials\",\n    msg_plain: Optional[str] = None,\n    email_from: Optional[str] = None,\n    email_to: Optional[Union[str, List[str]]] = None,\n    email_to_cc: Optional[Union[str, List[str]]] = None,\n    email_to_bcc: Optional[Union[str, List[str]]] = None,\n    attachments: Optional[List[str]] = None,\n):\n\"\"\"\n    Sends an email message from an authenticated email service over SMTP.\n    Sending messages containing HTML code is supported - the default MIME\n    type is set to the text/html.\n\n    Args:\n        subject: The subject line of the email.\n        msg: The contents of the email, added as html; can be used in\n            combination with msg_plain.\n        msg_plain: The contents of the email as plain text,\n            can be used in combination with msg.\n        email_to: The email addresses to send the message to, separated by commas.\n            If a list is provided, will join the items, separated by commas.\n        email_to_cc: Additional email addresses to send the message to as cc,\n            separated by commas. If a list is provided, will join the items,\n            separated by commas.\n        email_to_bcc: Additional email addresses to send the message to as bcc,\n            separated by commas. If a list is provided, will join the items,\n            separated by commas.\n        attachments: Names of files that should be sent as attachment.\n\n    Returns:\n        MimeText: The MIME Multipart message of the email.\n\n    Example:\n        Sends a notification email to someone@gmail.com.\n        ```python\n        from prefect import flow\n        from prefect_email import EmailServerCredentials, email_send_message\n\n        @flow\n        def example_email_send_message_flow():\n            email_server_credentials = EmailServerCredentials(\n                username=\"username@email.com\",\n                password=\"password\",\n            )\n            subject = email_send_message(\n                email_server_credentials=email_server_credentials,\n                subject=\"Example Flow Notification\",\n                msg=\"This proves email_send_message works!\",\n                email_to=\"someone@email.com\",\n            )\n            return subject\n\n        example_email_send_message_flow()\n        ```\n    \"\"\"\n    message = MIMEMultipart()\n    message[\"Subject\"] = subject\n    message[\"From\"] = email_from or email_server_credentials.username\n\n    email_to_dict = {\"To\": email_to, \"Cc\": email_to_cc, \"Bcc\": email_to_bcc}\n    if all(val is None for val in email_to_dict.values()):\n        raise ValueError(\n            \"One of email_to, email_to_cc, or email_to_bcc must be specified\"\n        )\n\n    for key, val in email_to_dict.items():\n        if isinstance(val, list):\n            val = \", \".join(val)\n        message[key] = val\n\n    # First add the message in plain text, then the HTML version;\n    # email clients try to render the last part first\n    if msg_plain:\n        message.attach(MIMEText(msg_plain, \"plain\"))\n    if msg:\n        message.attach(MIMEText(msg, \"html\"))\n\n    for filepath in attachments or []:\n        with open(filepath, \"rb\") as attachment:\n            part = MIMEBase(\"application\", \"octet-stream\")\n            part.set_payload(attachment.read())\n\n        encoders.encode_base64(part)\n        filename = os.path.basename(filepath)\n        part.add_header(\n            \"Content-Disposition\",\n            f\"attachment; filename= {filename}\",\n        )\n        message.attach(part)\n\n    with email_server_credentials.get_server() as server:\n        partial_send_message = partial(server.send_message, message)\n        await to_thread.run_sync(partial_send_message)\n\n    return message\n</code></pre>"}]}