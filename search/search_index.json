{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"prefect-email Welcome! prefect-email is a collection of prebuilt Prefect tasks that can be used to quickly construct Prefect flows that interacts with email services. Getting Started Python setup Requires an installation of Python 3.7+. We recommend using a Python virtual environment manager such as pipenv, conda or virtualenv. These tasks are designed to work with Prefect 2.0. For more information about how to use Prefect, please refer to the Prefect documentation . Installation Install prefect-email with pip : pip install prefect-email Then, register to view the block on Prefect Cloud: prefect block register -m prefect_email Note, to use the load method on Blocks, you must already have a block document saved through code or saved through the UI . Send an email using Gmail from prefect import flow from prefect_email import EmailServerCredentials , email_send_message @flow def example_email_send_message_flow (): email_server_credentials = EmailServerCredentials ( username = \"your_email_address@gmail.com\" , password = \"MUST_be_an_app_password_here!\" , ) subject = email_send_message ( email_server_credentials = email_server_credentials , subject = \"Example Flow Notification using Gmail\" , msg = \"This proves email_send_message works!\" , email_to = \"someone_awesome@gmail.com\" , ) return subject example_email_send_message_flow () Please note, many email services, like Gmail, require an App Password to successfully send emails. If you encounter an error similar to smtplib.SMTPAuthenticationError: (535, b'5.7.8 Username and Password not accepted... , it's likely you are not using an App Password. Resources If you encounter any bugs while using prefect-email , feel free to open an issue in the prefect-email repository. If you have any questions or issues while using prefect-email , you can find help in either the Prefect Discourse forum or the Prefect Slack community . Feel free to \u2b50\ufe0f or watch prefect-email for updates too! Development If you'd like to install a version of prefect-email for development, clone the repository and perform an editable install with pip : git clone https://github.com/PrefectHQ/prefect-email.git cd prefect-email/ pip install -e \".[dev]\" # Install linting pre-commit hooks pre-commit install","title":"Home"},{"location":"#prefect-email","text":"","title":"prefect-email"},{"location":"#welcome","text":"prefect-email is a collection of prebuilt Prefect tasks that can be used to quickly construct Prefect flows that interacts with email services.","title":"Welcome!"},{"location":"#getting-started","text":"","title":"Getting Started"},{"location":"#python-setup","text":"Requires an installation of Python 3.7+. We recommend using a Python virtual environment manager such as pipenv, conda or virtualenv. These tasks are designed to work with Prefect 2.0. For more information about how to use Prefect, please refer to the Prefect documentation .","title":"Python setup"},{"location":"#installation","text":"Install prefect-email with pip : pip install prefect-email Then, register to view the block on Prefect Cloud: prefect block register -m prefect_email Note, to use the load method on Blocks, you must already have a block document saved through code or saved through the UI .","title":"Installation"},{"location":"#send-an-email-using-gmail","text":"from prefect import flow from prefect_email import EmailServerCredentials , email_send_message @flow def example_email_send_message_flow (): email_server_credentials = EmailServerCredentials ( username = \"your_email_address@gmail.com\" , password = \"MUST_be_an_app_password_here!\" , ) subject = email_send_message ( email_server_credentials = email_server_credentials , subject = \"Example Flow Notification using Gmail\" , msg = \"This proves email_send_message works!\" , email_to = \"someone_awesome@gmail.com\" , ) return subject example_email_send_message_flow () Please note, many email services, like Gmail, require an App Password to successfully send emails. If you encounter an error similar to smtplib.SMTPAuthenticationError: (535, b'5.7.8 Username and Password not accepted... , it's likely you are not using an App Password.","title":"Send an email using Gmail"},{"location":"#resources","text":"If you encounter any bugs while using prefect-email , feel free to open an issue in the prefect-email repository. If you have any questions or issues while using prefect-email , you can find help in either the Prefect Discourse forum or the Prefect Slack community . Feel free to \u2b50\ufe0f or watch prefect-email for updates too!","title":"Resources"},{"location":"#development","text":"If you'd like to install a version of prefect-email for development, clone the repository and perform an editable install with pip : git clone https://github.com/PrefectHQ/prefect-email.git cd prefect-email/ pip install -e \".[dev]\" # Install linting pre-commit hooks pre-commit install","title":"Development"},{"location":"credentials/","text":"prefect_email.credentials Credential classes used to perform authenticated interactions with email services Classes EmailServerCredentials Bases: Block Block used to manage generic email server authentication. It is recommended you use a Google App Password if you use Gmail. Attributes: Name Type Description username Optional [ str ] The username to use for authentication to the server. Unnecessary if SMTP login is not required. password SecretStr The password to use for authentication to the server. Unnecessary if SMTP login is not required. smtp_server Union [ str , SMTPServer ] Either the hostname of the SMTP server, or one of the keys from the built-in SMTPServer Enum members, like \"gmail\". smtp_type Union [ str , SMTPType ] Either \"SSL\", \"STARTTLS\", or \"INSECURE\". smtp_port Optional [ int ] If provided, overrides the smtp_type's default port number. Example Load stored email server credentials: from prefect_email import EmailServerCredentials email_credentials_block = EmailServerCredentials . load ( \"BLOCK_NAME\" ) Source code in prefect_email/credentials.py 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 class EmailServerCredentials ( Block ): \"\"\" Block used to manage generic email server authentication. It is recommended you use a [Google App Password](https://support.google.com/accounts/answer/185833) if you use Gmail. Attributes: username: The username to use for authentication to the server. Unnecessary if SMTP login is not required. password: The password to use for authentication to the server. Unnecessary if SMTP login is not required. smtp_server: Either the hostname of the SMTP server, or one of the keys from the built-in SMTPServer Enum members, like \"gmail\". smtp_type: Either \"SSL\", \"STARTTLS\", or \"INSECURE\". smtp_port: If provided, overrides the smtp_type's default port number. Example: Load stored email server credentials: ```python from prefect_email import EmailServerCredentials email_credentials_block = EmailServerCredentials.load(\"BLOCK_NAME\") ``` \"\"\" # noqa E501 _block_type_name = \"Email Server Credentials\" _logo_url = \"https://images.ctfassets.net/gm98wzqotmnx/3PcxFuO9XUqs7wU9MiUBMg/ca740e27815d15528373aced667f58b9/email__1_.png?h=250\" # noqa username : Optional [ str ] = None password : SecretStr = SecretStr ( \"\" ) smtp_server : Union [ str , SMTPServer ] = SMTPServer . GMAIL smtp_type : Union [ str , SMTPType ] = SMTPType . SSL smtp_port : Optional [ int ] = None def get_server ( self ) -> SMTP : \"\"\" Gets an authenticated SMTP server. Returns: SMTP: An authenticated SMTP server. Example: Gets a GMail SMTP server through defaults. ```python from prefect import flow from prefect_email import EmailServerCredentials @flow def example_get_server_flow(): email_server_credentials = EmailServerCredentials( username=\"username@gmail.com\", password=\"password\", ) server = email_server_credentials.get_server() return server example_get_server_flow() ``` \"\"\" smtp_server = _cast_to_enum ( self . smtp_server , SMTPServer ) if isinstance ( smtp_server , SMTPServer ): smtp_server = smtp_server . value smtp_type = _cast_to_enum ( self . smtp_type , SMTPType , restrict = True ) smtp_port = self . smtp_port if smtp_port is None : smtp_port = smtp_type . value if smtp_type == SMTPType . INSECURE : server = SMTP ( smtp_server , smtp_port ) else : context = ssl . create_default_context () if smtp_type == SMTPType . SSL : server = SMTP_SSL ( smtp_server , smtp_port , context = context ) elif smtp_type == SMTPType . STARTTLS : server = SMTP ( smtp_server , smtp_port ) server . starttls ( context = context ) if self . username is not None : server . login ( self . username , self . password . get_secret_value ()) return server Functions get_server () Gets an authenticated SMTP server. Returns: Name Type Description SMTP SMTP An authenticated SMTP server. Example Gets a GMail SMTP server through defaults. from prefect import flow from prefect_email import EmailServerCredentials @flow def example_get_server_flow (): email_server_credentials = EmailServerCredentials ( username = \"username@gmail.com\" , password = \"password\" , ) server = email_server_credentials . get_server () return server example_get_server_flow () Source code in prefect_email/credentials.py 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 def get_server ( self ) -> SMTP : \"\"\" Gets an authenticated SMTP server. Returns: SMTP: An authenticated SMTP server. Example: Gets a GMail SMTP server through defaults. ```python from prefect import flow from prefect_email import EmailServerCredentials @flow def example_get_server_flow(): email_server_credentials = EmailServerCredentials( username=\"username@gmail.com\", password=\"password\", ) server = email_server_credentials.get_server() return server example_get_server_flow() ``` \"\"\" smtp_server = _cast_to_enum ( self . smtp_server , SMTPServer ) if isinstance ( smtp_server , SMTPServer ): smtp_server = smtp_server . value smtp_type = _cast_to_enum ( self . smtp_type , SMTPType , restrict = True ) smtp_port = self . smtp_port if smtp_port is None : smtp_port = smtp_type . value if smtp_type == SMTPType . INSECURE : server = SMTP ( smtp_server , smtp_port ) else : context = ssl . create_default_context () if smtp_type == SMTPType . SSL : server = SMTP_SSL ( smtp_server , smtp_port , context = context ) elif smtp_type == SMTPType . STARTTLS : server = SMTP ( smtp_server , smtp_port ) server . starttls ( context = context ) if self . username is not None : server . login ( self . username , self . password . get_secret_value ()) return server SMTPServer Bases: Enum Server used to send email. Source code in prefect_email/credentials.py 22 23 24 25 26 27 28 29 30 31 32 33 class SMTPServer ( Enum ): \"\"\" Server used to send email. \"\"\" AOL = \"smtp.aol.com\" ATT = \"smtp.mail.att.net\" COMCAST = \"smtp.comcast.net\" ICLOUD = \"smtp.mail.me.com\" GMAIL = \"smtp.gmail.com\" OUTLOOK = \"smtp-mail.outlook.com\" YAHOO = \"smtp.mail.yahoo.com\" SMTPType Bases: Enum Protocols used to secure email transmissions. Source code in prefect_email/credentials.py 12 13 14 15 16 17 18 19 class SMTPType ( Enum ): \"\"\" Protocols used to secure email transmissions. \"\"\" SSL = 465 STARTTLS = 587 INSECURE = 25","title":"Credentials"},{"location":"credentials/#prefect_email.credentials","text":"Credential classes used to perform authenticated interactions with email services","title":"credentials"},{"location":"credentials/#prefect_email.credentials-classes","text":"","title":"Classes"},{"location":"credentials/#prefect_email.credentials.EmailServerCredentials","text":"Bases: Block Block used to manage generic email server authentication. It is recommended you use a Google App Password if you use Gmail. Attributes: Name Type Description username Optional [ str ] The username to use for authentication to the server. Unnecessary if SMTP login is not required. password SecretStr The password to use for authentication to the server. Unnecessary if SMTP login is not required. smtp_server Union [ str , SMTPServer ] Either the hostname of the SMTP server, or one of the keys from the built-in SMTPServer Enum members, like \"gmail\". smtp_type Union [ str , SMTPType ] Either \"SSL\", \"STARTTLS\", or \"INSECURE\". smtp_port Optional [ int ] If provided, overrides the smtp_type's default port number. Example Load stored email server credentials: from prefect_email import EmailServerCredentials email_credentials_block = EmailServerCredentials . load ( \"BLOCK_NAME\" ) Source code in prefect_email/credentials.py 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 class EmailServerCredentials ( Block ): \"\"\" Block used to manage generic email server authentication. It is recommended you use a [Google App Password](https://support.google.com/accounts/answer/185833) if you use Gmail. Attributes: username: The username to use for authentication to the server. Unnecessary if SMTP login is not required. password: The password to use for authentication to the server. Unnecessary if SMTP login is not required. smtp_server: Either the hostname of the SMTP server, or one of the keys from the built-in SMTPServer Enum members, like \"gmail\". smtp_type: Either \"SSL\", \"STARTTLS\", or \"INSECURE\". smtp_port: If provided, overrides the smtp_type's default port number. Example: Load stored email server credentials: ```python from prefect_email import EmailServerCredentials email_credentials_block = EmailServerCredentials.load(\"BLOCK_NAME\") ``` \"\"\" # noqa E501 _block_type_name = \"Email Server Credentials\" _logo_url = \"https://images.ctfassets.net/gm98wzqotmnx/3PcxFuO9XUqs7wU9MiUBMg/ca740e27815d15528373aced667f58b9/email__1_.png?h=250\" # noqa username : Optional [ str ] = None password : SecretStr = SecretStr ( \"\" ) smtp_server : Union [ str , SMTPServer ] = SMTPServer . GMAIL smtp_type : Union [ str , SMTPType ] = SMTPType . SSL smtp_port : Optional [ int ] = None def get_server ( self ) -> SMTP : \"\"\" Gets an authenticated SMTP server. Returns: SMTP: An authenticated SMTP server. Example: Gets a GMail SMTP server through defaults. ```python from prefect import flow from prefect_email import EmailServerCredentials @flow def example_get_server_flow(): email_server_credentials = EmailServerCredentials( username=\"username@gmail.com\", password=\"password\", ) server = email_server_credentials.get_server() return server example_get_server_flow() ``` \"\"\" smtp_server = _cast_to_enum ( self . smtp_server , SMTPServer ) if isinstance ( smtp_server , SMTPServer ): smtp_server = smtp_server . value smtp_type = _cast_to_enum ( self . smtp_type , SMTPType , restrict = True ) smtp_port = self . smtp_port if smtp_port is None : smtp_port = smtp_type . value if smtp_type == SMTPType . INSECURE : server = SMTP ( smtp_server , smtp_port ) else : context = ssl . create_default_context () if smtp_type == SMTPType . SSL : server = SMTP_SSL ( smtp_server , smtp_port , context = context ) elif smtp_type == SMTPType . STARTTLS : server = SMTP ( smtp_server , smtp_port ) server . starttls ( context = context ) if self . username is not None : server . login ( self . username , self . password . get_secret_value ()) return server","title":"EmailServerCredentials"},{"location":"credentials/#prefect_email.credentials.EmailServerCredentials-functions","text":"","title":"Functions"},{"location":"credentials/#prefect_email.credentials.EmailServerCredentials.get_server","text":"Gets an authenticated SMTP server. Returns: Name Type Description SMTP SMTP An authenticated SMTP server. Example Gets a GMail SMTP server through defaults. from prefect import flow from prefect_email import EmailServerCredentials @flow def example_get_server_flow (): email_server_credentials = EmailServerCredentials ( username = \"username@gmail.com\" , password = \"password\" , ) server = email_server_credentials . get_server () return server example_get_server_flow () Source code in prefect_email/credentials.py 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 def get_server ( self ) -> SMTP : \"\"\" Gets an authenticated SMTP server. Returns: SMTP: An authenticated SMTP server. Example: Gets a GMail SMTP server through defaults. ```python from prefect import flow from prefect_email import EmailServerCredentials @flow def example_get_server_flow(): email_server_credentials = EmailServerCredentials( username=\"username@gmail.com\", password=\"password\", ) server = email_server_credentials.get_server() return server example_get_server_flow() ``` \"\"\" smtp_server = _cast_to_enum ( self . smtp_server , SMTPServer ) if isinstance ( smtp_server , SMTPServer ): smtp_server = smtp_server . value smtp_type = _cast_to_enum ( self . smtp_type , SMTPType , restrict = True ) smtp_port = self . smtp_port if smtp_port is None : smtp_port = smtp_type . value if smtp_type == SMTPType . INSECURE : server = SMTP ( smtp_server , smtp_port ) else : context = ssl . create_default_context () if smtp_type == SMTPType . SSL : server = SMTP_SSL ( smtp_server , smtp_port , context = context ) elif smtp_type == SMTPType . STARTTLS : server = SMTP ( smtp_server , smtp_port ) server . starttls ( context = context ) if self . username is not None : server . login ( self . username , self . password . get_secret_value ()) return server","title":"get_server()"},{"location":"credentials/#prefect_email.credentials.SMTPServer","text":"Bases: Enum Server used to send email. Source code in prefect_email/credentials.py 22 23 24 25 26 27 28 29 30 31 32 33 class SMTPServer ( Enum ): \"\"\" Server used to send email. \"\"\" AOL = \"smtp.aol.com\" ATT = \"smtp.mail.att.net\" COMCAST = \"smtp.comcast.net\" ICLOUD = \"smtp.mail.me.com\" GMAIL = \"smtp.gmail.com\" OUTLOOK = \"smtp-mail.outlook.com\" YAHOO = \"smtp.mail.yahoo.com\"","title":"SMTPServer"},{"location":"credentials/#prefect_email.credentials.SMTPType","text":"Bases: Enum Protocols used to secure email transmissions. Source code in prefect_email/credentials.py 12 13 14 15 16 17 18 19 class SMTPType ( Enum ): \"\"\" Protocols used to secure email transmissions. \"\"\" SSL = 465 STARTTLS = 587 INSECURE = 25","title":"SMTPType"},{"location":"message/","text":"prefect_email.message Tasks for interacting with email message services Classes Functions email_send_message ( subject , msg , email_server_credentials , msg_plain = None , email_from = None , email_to = None , email_to_cc = None , email_to_bcc = None , attachments = None ) async Sends an email message from an authenticated email service over SMTP. Sending messages containing HTML code is supported - the default MIME type is set to the text/html. Parameters: Name Type Description Default subject str The subject line of the email. required msg str The contents of the email, added as html; can be used in combination with msg_plain. required msg_plain Optional [ str ] The contents of the email as plain text, can be used in combination with msg. None email_to Optional [ Union [ str , List [ str ]]] The email addresses to send the message to, separated by commas. If a list is provided, will join the items, separated by commas. None email_to_cc Optional [ Union [ str , List [ str ]]] Additional email addresses to send the message to as cc, separated by commas. If a list is provided, will join the items, separated by commas. None email_to_bcc Optional [ Union [ str , List [ str ]]] Additional email addresses to send the message to as bcc, separated by commas. If a list is provided, will join the items, separated by commas. None attachments Optional [ List [ str ]] Names of files that should be sent as attachment. None Returns: Name Type Description MimeText The MIME Multipart message of the email. Example Sends a notification email to someone@gmail.com. from prefect import flow from prefect_email import EmailServerCredentials , email_send_message @flow def example_email_send_message_flow (): email_server_credentials = EmailServerCredentials ( username = \"username@email.com\" , password = \"password\" , ) subject = email_send_message ( email_server_credentials = email_server_credentials , subject = \"Example Flow Notification\" , msg = \"This proves email_send_message works!\" , email_to = \"someone@email.com\" , ) return subject example_email_send_message_flow () Source code in prefect_email/message.py 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 @task async def email_send_message ( subject : str , msg : str , email_server_credentials : \"EmailServerCredentials\" , msg_plain : Optional [ str ] = None , email_from : Optional [ str ] = None , email_to : Optional [ Union [ str , List [ str ]]] = None , email_to_cc : Optional [ Union [ str , List [ str ]]] = None , email_to_bcc : Optional [ Union [ str , List [ str ]]] = None , attachments : Optional [ List [ str ]] = None , ): \"\"\" Sends an email message from an authenticated email service over SMTP. Sending messages containing HTML code is supported - the default MIME type is set to the text/html. Args: subject: The subject line of the email. msg: The contents of the email, added as html; can be used in combination with msg_plain. msg_plain: The contents of the email as plain text, can be used in combination with msg. email_to: The email addresses to send the message to, separated by commas. If a list is provided, will join the items, separated by commas. email_to_cc: Additional email addresses to send the message to as cc, separated by commas. If a list is provided, will join the items, separated by commas. email_to_bcc: Additional email addresses to send the message to as bcc, separated by commas. If a list is provided, will join the items, separated by commas. attachments: Names of files that should be sent as attachment. Returns: MimeText: The MIME Multipart message of the email. Example: Sends a notification email to someone@gmail.com. ```python from prefect import flow from prefect_email import EmailServerCredentials, email_send_message @flow def example_email_send_message_flow(): email_server_credentials = EmailServerCredentials( username=\"username@email.com\", password=\"password\", ) subject = email_send_message( email_server_credentials=email_server_credentials, subject=\"Example Flow Notification\", msg=\"This proves email_send_message works!\", email_to=\"someone@email.com\", ) return subject example_email_send_message_flow() ``` \"\"\" message = MIMEMultipart () message [ \"Subject\" ] = subject message [ \"From\" ] = email_from or email_server_credentials . username email_to_dict = { \"To\" : email_to , \"Cc\" : email_to_cc , \"Bcc\" : email_to_bcc } if all ( val is None for val in email_to_dict . values ()): raise ValueError ( \"One of email_to, email_to_cc, or email_to_bcc must be specified\" ) for key , val in email_to_dict . items (): if isinstance ( val , list ): val = \", \" . join ( val ) message [ key ] = val # First add the message in plain text, then the HTML version; # email clients try to render the last part first if msg_plain : message . attach ( MIMEText ( msg_plain , \"plain\" )) if msg : message . attach ( MIMEText ( msg , \"html\" )) for filepath in attachments or []: with open ( filepath , \"rb\" ) as attachment : part = MIMEBase ( \"application\" , \"octet-stream\" ) part . set_payload ( attachment . read ()) encoders . encode_base64 ( part ) filename = os . path . basename ( filepath ) part . add_header ( \"Content-Disposition\" , f \"attachment; filename= { filename } \" , ) message . attach ( part ) with email_server_credentials . get_server () as server : partial_send_message = partial ( server . send_message , message ) await to_thread . run_sync ( partial_send_message ) return message","title":"Message"},{"location":"message/#prefect_email.message","text":"Tasks for interacting with email message services","title":"message"},{"location":"message/#prefect_email.message-classes","text":"","title":"Classes"},{"location":"message/#prefect_email.message-functions","text":"","title":"Functions"},{"location":"message/#prefect_email.message.email_send_message","text":"Sends an email message from an authenticated email service over SMTP. Sending messages containing HTML code is supported - the default MIME type is set to the text/html. Parameters: Name Type Description Default subject str The subject line of the email. required msg str The contents of the email, added as html; can be used in combination with msg_plain. required msg_plain Optional [ str ] The contents of the email as plain text, can be used in combination with msg. None email_to Optional [ Union [ str , List [ str ]]] The email addresses to send the message to, separated by commas. If a list is provided, will join the items, separated by commas. None email_to_cc Optional [ Union [ str , List [ str ]]] Additional email addresses to send the message to as cc, separated by commas. If a list is provided, will join the items, separated by commas. None email_to_bcc Optional [ Union [ str , List [ str ]]] Additional email addresses to send the message to as bcc, separated by commas. If a list is provided, will join the items, separated by commas. None attachments Optional [ List [ str ]] Names of files that should be sent as attachment. None Returns: Name Type Description MimeText The MIME Multipart message of the email. Example Sends a notification email to someone@gmail.com. from prefect import flow from prefect_email import EmailServerCredentials , email_send_message @flow def example_email_send_message_flow (): email_server_credentials = EmailServerCredentials ( username = \"username@email.com\" , password = \"password\" , ) subject = email_send_message ( email_server_credentials = email_server_credentials , subject = \"Example Flow Notification\" , msg = \"This proves email_send_message works!\" , email_to = \"someone@email.com\" , ) return subject example_email_send_message_flow () Source code in prefect_email/message.py 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 @task async def email_send_message ( subject : str , msg : str , email_server_credentials : \"EmailServerCredentials\" , msg_plain : Optional [ str ] = None , email_from : Optional [ str ] = None , email_to : Optional [ Union [ str , List [ str ]]] = None , email_to_cc : Optional [ Union [ str , List [ str ]]] = None , email_to_bcc : Optional [ Union [ str , List [ str ]]] = None , attachments : Optional [ List [ str ]] = None , ): \"\"\" Sends an email message from an authenticated email service over SMTP. Sending messages containing HTML code is supported - the default MIME type is set to the text/html. Args: subject: The subject line of the email. msg: The contents of the email, added as html; can be used in combination with msg_plain. msg_plain: The contents of the email as plain text, can be used in combination with msg. email_to: The email addresses to send the message to, separated by commas. If a list is provided, will join the items, separated by commas. email_to_cc: Additional email addresses to send the message to as cc, separated by commas. If a list is provided, will join the items, separated by commas. email_to_bcc: Additional email addresses to send the message to as bcc, separated by commas. If a list is provided, will join the items, separated by commas. attachments: Names of files that should be sent as attachment. Returns: MimeText: The MIME Multipart message of the email. Example: Sends a notification email to someone@gmail.com. ```python from prefect import flow from prefect_email import EmailServerCredentials, email_send_message @flow def example_email_send_message_flow(): email_server_credentials = EmailServerCredentials( username=\"username@email.com\", password=\"password\", ) subject = email_send_message( email_server_credentials=email_server_credentials, subject=\"Example Flow Notification\", msg=\"This proves email_send_message works!\", email_to=\"someone@email.com\", ) return subject example_email_send_message_flow() ``` \"\"\" message = MIMEMultipart () message [ \"Subject\" ] = subject message [ \"From\" ] = email_from or email_server_credentials . username email_to_dict = { \"To\" : email_to , \"Cc\" : email_to_cc , \"Bcc\" : email_to_bcc } if all ( val is None for val in email_to_dict . values ()): raise ValueError ( \"One of email_to, email_to_cc, or email_to_bcc must be specified\" ) for key , val in email_to_dict . items (): if isinstance ( val , list ): val = \", \" . join ( val ) message [ key ] = val # First add the message in plain text, then the HTML version; # email clients try to render the last part first if msg_plain : message . attach ( MIMEText ( msg_plain , \"plain\" )) if msg : message . attach ( MIMEText ( msg , \"html\" )) for filepath in attachments or []: with open ( filepath , \"rb\" ) as attachment : part = MIMEBase ( \"application\" , \"octet-stream\" ) part . set_payload ( attachment . read ()) encoders . encode_base64 ( part ) filename = os . path . basename ( filepath ) part . add_header ( \"Content-Disposition\" , f \"attachment; filename= { filename } \" , ) message . attach ( part ) with email_server_credentials . get_server () as server : partial_send_message = partial ( server . send_message , message ) await to_thread . run_sync ( partial_send_message ) return message","title":"email_send_message()"}]}